# This file is GENERATED BY
# CI-testing/translate-travis.yml-to-github-actions.py
jobs:
    perl:
        runs-on: windows-latest
        steps:
        -   name: Setup perl
            uses: shogo82148/actions-setup-perl@v1
            with:
                distribution: strawberry
                perl-version: ${{ matrix.perl-version }}
        -   name: Set git to use LF
            run: 'git config --global core.autocrlf false

                git config --global core.eol lf

                '
        -   uses: actions/checkout@v2
            with:
                submodules: 'true'
        -   name: perl -V
            run: perl -V
        -   name: install cpanm and mult modules
            uses: perl-actions/install-with-cpanm@v1
            with:
                install: 'App::Docmake

                    Code::TidyAll::Plugin::ClangFormat

                    Code::TidyAll::Plugin::Flake8

                    Code::TidyAll::Plugin::TestCount

                    Env::Path

                    File::Find::Object

                    IO::All

                    List::Util

                    Path::Tiny

                    Perl::Critic

                    Perl::Tidy

                    Pod::Coverage::TrustPod

                    String::ShellQuote

                    Test::Code::TidyAll

                    Test::Differences

                    Test::EOL

                    Test::Pod

                    Test::Pod::Coverage

                    Test::RunValgrind

                    Test::TrailingSpace

                    Test::Trap'
        -   name: Set up MinGW
            uses: egor-tensin/setup-mingw@v2
            with:
                platform: x86
        -   name: install and test_script code
            run: '@echo on

                SET MSYSTEM=MINGW64

                SET VERBOSE=1

                SET CC=cc

                SET CXX=c++

                IF NOT EXIST C:\strawberry ( echo "strawberryperl is not installed.
                Please fix appveyor.yml" exit 1 ) || ( echo Failed & exit /B 1 )

                SET PATH=C:\strawberry\c\bin;C:\strawberry\perl\site\bin;C:\strawberry\perl\bin;%PATH%

                perl -v || ( echo Failed & exit /B 1 )

                IF NOT EXIST C:\Perl5 mkdir C:\Perl5 || ( echo Failed & exit /B 1
                )

                SET PATH=C:\msys64\bin;C:\Perl5\bin;C:\strawberry\c\bin;C:\strawberry\perl\site\bin;C:\strawberry\perl\bin;%PATH%

                SET PERL5LIB=C:/Perl5/lib/perl5

                SET PERL_LOCAL_LIB_ROOT=C:/Perl5

                SET PERL_MB_OPT=--install_base C:/Perl5

                SET PERL_MM_OPT=INSTALL_BASE=C:/Perl5

                C:\cygwin64\setup-x86_64.exe -qgnNdO -l C:\cygwin64\var\cache\setup
                -R c:\cygwin64 -s http://cygwin.mirror.constant.com -P docbook-xml
                -P docbook-xsl -P libxml2 -P libxslt || ( echo Failed & exit /B 1
                )

                set CMAKE_MAKE_PROGRAM=C:\strawberry\c\bin\gmake.exe

                set CPATH=c:\mingw64\include;c:\msys64\mingw64\include

                set LIBRARY_PATH=c:\mingw64\lib;c:\msys64\mingw64\lib

                set PATH=%PATH%;c:\mingw64\lib;c:\mingw64\bin;c:\msys64\mingw64\lib;c:\msys64\mingw64\bin

                SET PATH=%PATH%;C:\Python35-x64

                SET FORTUNE_TEST_DEBUG=1

                SET DOCMAKE_PATH_PREFIX="C:\cygwin64\bin;"

                perl CI-testing/continuous-integration-testing.pl --gen="MSYS Makefiles"
                || ( echo Failed & exit /B 1 )

                '
            shell: cmd
        strategy:
            fail-fast: true
            matrix:
                perl-version:
                - '5.30'
name: windows-x86
'on':
- push
